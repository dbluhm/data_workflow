{% extends "base.html" %}

{% block title %}{{ instrument }} {{ ipts_number|upper }} Data Processing Report {% endblock %}
{% block header %}
<script>
    function show_local_alert() {
        $(".user_alert").show("slide", {direction:'right'}, 500 );
        $(".user_alert").click(function(){window.location.href = '{{ ipts_url }}'});
    };

    function poll(){
        $.ajax({ url: "{{ update_url }}?since={{ last_run.run_number }}", success: function(data){
        	if (data.refresh_needed.localeCompare('1')==0){
    			new_alert("Run "+data.last_run+" is available<br><div id='click_me'>- click to refresh -</div>");
    			show_local_alert();
    		}
    	}, dataType: "json", timeout: 30000 });
	};
</script>   
{% endblock %}

{% block banner %}{{ instrument }} {{ ipts_number|upper }} Data Processing Report {% endblock %}

{% block summary %}
      Title: {{ icat_info.title|default:"unknown" }}<br>
      Created on: {{ icat_info.createTime|default:"unknown" }}<br>      
{% endblock %}

{% block bodytop %}
<script id="source" language="javascript" type="text/javascript">
    setInterval(poll, 10000);
</script>
{% endblock %}
    
{% block content %}
List of {{ instrument }} runs for {{ ipts_number|upper }}:<br>
      <div id="details">
      <table cellspacing="0" class="message_table">
      <thead>
      <tr>
      {% for item in run_list_header %}
          <th {% if item.style %} style="{{item.style}}" {% endif %} {% if item.class %} class="{{item.class}}" {% endif %}> {% if item.url %}<a href={{ item.url|safe }}> {% endif %} {{ item.name|safe }} {% if item.url %}</a>{% endif %}</th>
      {% endfor %}
      </tr>
      </thead>
      <tbody>
      {% for item in run_list %}
          <tr class="{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
          <td><a href='{{ base_run_url }}{{ item.run_number }}/'>{{ item.run_number }}</a></td>
          <td>{{ item.created_on }}</td>
          {% if item.last_error %} 
          <td class="error">{{ item.last_error }}</td>
          {% else %}
          <td></td>
          {% endif %}
          </tr>
      {% endfor %}
      </tbody>
      </table>
      </div>
      <br>
      {% if not all_shown %}
      {{ number_shown }} of {{ number_of_runs }} runs shown - <a href='{{ ipts_url }}?show=all'>show all runs</a>
      {% endif %}

{% endblock %}