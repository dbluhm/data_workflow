{% extends "base.html" %}

{% block title %} Instrument Status {% endblock %}

{% block banner %} Instrument Status {% endblock %}

{% block header %}
<script>
    var plotted_vars = [];
    var plotted_data = [];

    function poll() {
        $.ajax({ url: "{{ update_url }}", success: function(data) {
            for (var i=0; i<data.instruments.length; i++)
            { 
                var content = "<li class='status_"+data.instruments[i].dasmon_status+"' id='"+data.instruments[i].name+"_dasmon_status'>DASMON</li>";
                $('#'+data.instruments[i].name+'_dasmon_status').replaceWith(content);
                $('#'+data.instruments[i].name+'_workflow_status').replaceWith("<li class='status_"+data.postprocess_status.workflow+"' id='"+data.instruments[i].name+"_workflow_status'>Workflow</li>");
                $('#'+data.instruments[i].name+'_catalog_status').replaceWith("<li class='status_"+data.postprocess_status.catalog+"' id='"+data.instruments[i].name+"_catalog_status'>Catalog</li>");
                $('#'+data.instruments[i].name+'_reduction_status').replaceWith("<li class='status_"+data.postprocess_status.reduction+"' id='"+data.instruments[i].name+"_reduction_status'>Reduction</li>");

                content = "<li class='status_"+data.instruments[i].completeness+"' id='"+data.instruments[i].name+"_completeness'>Data reduced</td>";
                $('#'+data.instruments[i].name+'_completeness').replaceWith(content);
            }

        }, dataType: "json", timeout: 30000 });
    };
</script>
{% endblock %}    

{% block bodytop %}
<script id="source" language="javascript" type="text/javascript">
    setInterval(poll, 5000);
</script>
{% endblock %}

{% block summary %}

List of instruments:<br>
  	<table cellspacing="0" class="message_table">
  	<thead>
  	<tr>
  		<th style="min-width:100px">Instrument</th> <th>System status</th> <th>Processing completion</th>
  	</tr>
  	</thead>
  	<tbody class='status_box'>
   	{% for item in instruments %}
	   	<tr>
	   	<td><a href='{{ item.url|safe }}'>{{ item.name|upper }}</a></td>
	   	<td>
            <ul>
                <li class='status_{{ item.dasmon_status }}' id='{{ item.name }}_dasmon_status'>DASMON</li> 
                <li class='status_{{ postprocess_status.workflow }}' id='{{ item.name }}_workflow_status'>Workflow</li>
                <li class='status_{{ postprocess_status.catalog }}' id='{{ item.name }}_catalog_status'>Catalog</li>
                <li class='status_{{ postprocess_status.reduction }}' id='{{ item.name }}_reduction_status'>Reduction</li>
            </ul>
        </td>
        <td> 
            <ul>
                <li class='status_{{ item.completeness }}' id='{{ item.name }}_completeness'>Data reduced</li>
            </ul>
        </td>
	   	</tr>
   	{% endfor %}
   	</tbody>
   	</table>
{% endblock %}
{% block nocontent %}{% endblock %}